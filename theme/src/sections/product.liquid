<section data-section-id="{{ section.id }}" data-section-type="product">

  {%- assign current_variant = product.selected_or_first_available_variant -%}
  {%- assign featured_image = current_variant.featured_image | default: product.featured_image -%}

  {% for image in product.images %}
    {% capture wrapper_class %}
      {%- unless featured_image == image -%}
        hide
      {%- endunless -%}
    {% endcapture %}

    {% include 'responsive-image' with
      image: image,
      max_width: 700,
      max_height: 800,
      image_attributes: "data-product-featured-image",
      wrapper_class: wrapper_class,
      wrapper_attributes: "data-product-image-wrapper",
    %}
  {% endfor %}

  {% if product.images.size > 1 %}
    <ul>
      {% for image in product.images %}
        <li>
          <a href="{{ image.src | img_url: '480x480' }}" data-thumbnail-id="{{ image.id }}" data-product-single-thumbnail{% if featured_image == image %} aria-current="true"{% endif %}>
            <img class="product-single__thumbnail-image" src="{{ image.src | img_url: '160x160' }}" alt="{{ image.alt | escape }}">
          </a>
        </li>
      {% endfor %}
    </ul>
  {% endif %}


    {% include 'breadcrumbs' %}
    <p>{{ product.vendor }}</p>



  {% if product.metafields.custom_fields["date"] != blank %}
      <h3 class="custom-field--title">Date</h3>
        {{ product.metafields.custom_fields["date"] | date: "%m/%d/%Y" }}
  {% endif %}

  {% if product.metafields.custom_fields["start_time"] != blank and product.metafields.custom_fields["start_time"] != blank %}
    {{ product.metafields.custom_fields["start_time"] }} - {{ product.metafields.custom_fields["end_time"] }}
  </div>
  {% endif %}

  {% if product.metafields.custom_fields["location"] != blank %}
      <h3 class="custom-field--title">Location</h3>
      {{ product.metafields.custom_fields["location"] }}
  {% endif %}

  <h1>{{ product.title }}</h1>

  <div class="rte">
    {{ product.description }}
  </div>

  <h2>Comedians list</h2>
  {% if product.metafields.custom_fields["comedians"] != blank %}
    <div class="custom-field custom-field__comedians custom-field__type--field-collection">
      <div class="custom-field--value">
        {% assign separator = "|###|" %}
        {% assign name_array = product.metafields.custom_fields["name"] | split: separator %}
        {% assign avatar_array = product.metafields.custom_fields["avatar"] | split: separator %}
        {% assign fc_keys = product.metafields.custom_fields["comedians"] | split: "," %}
        {% for i in fc_keys %}
          {% assign index = i | plus: 0 %}
          <div class="fc-item fc-item-- fc-index--{{ index }}">
            <div class="fc-field field__name">
              {{ name_array[index] }}
            </div>
            <div class="fc-field field__avatar">
              {{ avatar_array[index] }}
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
  {% endif %}

</section>

<section class="spacing-top-and-bottom-xs" id="product-collection">
  <div class="row center-xs">
    <div class="col-xs-10">
      <h2 class="font-barlow"><span class="custom-110">More Events</h2>
    </div>
  </div>
  <!-- {% include 'icon-large-ticket-red' %} {% include 'icon-table-and-chairs' %} {% include 'icon-microphone' %} -->
  <div class="row">
    <div class="col-lg-10 col-lg-offset-1 col-md-10 col-md-offset-1 col-sm-10 col-sm-offset-1 col-xs-12 col-xs-offset-0">
      <ul class="row schedule-list">
        {% for product in collections.home-featured.products %}
          <li class="col-lg-4 col-md-4 col-sm-4 col-xs-6" id="schedule-item-{{ forloop.index }}">
            <a href="{{ product.url }}" class="absolute-link"></a>
            <div class="top">
              <ul class="date row middle-xs">
                <li>{% include 'icon-calendar-red' %}</li>
                <li>
                  {% if product.metafields.custom_fields["date"] != blank %} 
                    <p class="small">{{ product.metafields.custom_fields["date"] | date: "%B %d, %Y" }}</p>
                  {% endif %}
                </li>
              </ul>

              <h5>{{ product.title }}</h5>

              <ul class="price-and-location row middle-xs">
                <li>
                  <p>{{ product.price | money_without_trailing_zeros }}</p>
                </li>
                <li>
                  {% include 'icon-small-red-pin' %}
                  {% if product.metafields.custom_fields["location"] != blank %}
                    {{ product.metafields.custom_fields["location"] }}
                  {% endif %}
                </li>
              </ul>

              <a href="{{ product.url }}" class="underline-button-double red">View details</a>
            </div>
            <div class="bws-button-wrapper">
              <button data-cart-add="{{ product.variants.first.id }}" data-cart-quantity="1" class="regular-button bws-button">
                <div class="inner-wrapper">
                  {% include 'icon-ticket-light' %}
                  <span class="text">ADD TO CART</span>
                </div>
              </button>
            </div>
          </li>
        {% endfor %}
      </ul>
    </div>
  </div>
  <div class="row center-xs">
    <div class="bws-button-wrapper">
      <a href="/pages/schedule" class="underline-button-double red">More Shows</a>
    </div>
  </div>
</section>

<sidebar>

  <h4>{{ product.title }}</h4>

  <span class="price">{{ product.price | money_without_trailing_zeros }}</span>

  {% if product.metafields.custom_fields["date"] != blank %}
      <h3 class="custom-field--title">Date</h3>
        {{ product.metafields.custom_fields["date"] | date: "%m/%d/%Y" }}
  {% endif %}

  {% if product.metafields.custom_fields["start_time"] != blank and product.metafields.custom_fields["start_time"] != blank %}
    {{ product.metafields.custom_fields["start_time"] }} - {{ product.metafields.custom_fields["end_time"] }}
  </div>
  {% endif %}

  {% if product.metafields.custom_fields["location"] != blank %}
      <h3 class="custom-field--title">Location</h3>
      {{ product.metafields.custom_fields["location"] }}
  {% endif %}

  <div class="control">
    <div class="minus">
      <a  href="#" data-control="-1" class="js-operator">-</a>
    </div>
    <div class="qty cart__qty-input">
      <span class="medium-up--hide js-current">1</span>
    </div>
    <div class="plus">
      <a  href="#" data-control="+1" class="js-operator">+</a>
    </div>
  </div>

  <form action="/cart/add" method="post" data-cart-submit>

  <button class="regular-button bws-button js-button" type="submit" 
    {% if product.available == false %} disabled="disabled"{% endif %}>
      <span data-submit-button-text>
        {% if product.available %}
          {{ 'products.product.add_to_cart' | t }}
        {% else %}
          {{ 'products.product.sold_out' | t }}
        {% endif %}
      </span>

      <select class="hidden" name="id">
          <option value="{{ product.variants.first.id }}"></option>
      </select>
  </button>

  <input type="hidden" name="properties[Date]" value="{{ product.metafields.custom_fields["date"] | date: "%B %d, %Y" }}"/>

  <select name="quantity" class="hidden js-quantity">
      <option>1</option>
  </select>

  </form>

</sidebar>

{% schema %}
  {
    "name": "Product pages",
    "settings": [
      {
        "type": "checkbox",
        "id": "show_share_buttons",
        "label": "Show social sharing buttons",
        "default": true
      }
    ]
  }
{% endschema %}
